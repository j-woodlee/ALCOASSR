{"version":3,"sources":["../../../../../lib/xlsx/xform/core/core-xform.js"],"names":["utils","require","XmlStream","BaseXform","DateXform","StringXform","IntegerXform","CoreXform","map","tag","format","DateFormat","attrs","DateAttrs","dt","toISOString","replace","CORE_PROPERTY_ATTRIBUTES","inherits","render","xmlStream","model","openXml","StdDocAttributes","openNode","creator","title","subject","description","identifier","language","keywords","category","lastModifiedBy","lastPrinted","revision","version","contentStatus","contentType","created","modified","closeNode","parseOpen","node","parser","name","Error","JSON","stringify","parseText","text","parseClose","undefined","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nconst utils = require('../../../utils/utils');\nconst XmlStream = require('../../../utils/xml-stream');\nconst BaseXform = require('../base-xform');\nconst DateXform = require('../simple/date-xform');\nconst StringXform = require('../simple/string-xform');\nconst IntegerXform = require('../simple/integer-xform');\n\nconst CoreXform = function() {\n  this.map = {\n    'dc:creator': new StringXform({ tag: 'dc:creator' }),\n    'dc:title': new StringXform({ tag: 'dc:title' }),\n    'dc:subject': new StringXform({ tag: 'dc:subject' }),\n    'dc:description': new StringXform({ tag: 'dc:description' }),\n    'dc:identifier': new StringXform({ tag: 'dc:identifier' }),\n    'dc:language': new StringXform({ tag: 'dc:language' }),\n    'cp:keywords': new StringXform({ tag: 'cp:keywords' }),\n    'cp:category': new StringXform({ tag: 'cp:category' }),\n    'cp:lastModifiedBy': new StringXform({ tag: 'cp:lastModifiedBy' }),\n    'cp:lastPrinted': new DateXform({ tag: 'cp:lastPrinted', format: CoreXform.DateFormat }),\n    'cp:revision': new IntegerXform({ tag: 'cp:revision' }),\n    'cp:version': new StringXform({ tag: 'cp:version' }),\n    'cp:contentStatus': new StringXform({ tag: 'cp:contentStatus' }),\n    'cp:contentType': new StringXform({ tag: 'cp:contentType' }),\n    'dcterms:created': new DateXform({ tag: 'dcterms:created', attrs: CoreXform.DateAttrs, format: CoreXform.DateFormat }),\n    'dcterms:modified': new DateXform({ tag: 'dcterms:modified', attrs: CoreXform.DateAttrs, format: CoreXform.DateFormat }),\n  };\n};\n\nCoreXform.DateFormat = function(dt) {\n  return dt.toISOString().replace(/[.]\\d{3}/, '');\n};\nCoreXform.DateAttrs = { 'xsi:type': 'dcterms:W3CDTF' };\n\nCoreXform.CORE_PROPERTY_ATTRIBUTES = {\n  'xmlns:cp': 'http://schemas.openxmlformats.org/package/2006/metadata/core-properties',\n  'xmlns:dc': 'http://purl.org/dc/elements/1.1/',\n  'xmlns:dcterms': 'http://purl.org/dc/terms/',\n  'xmlns:dcmitype': 'http://purl.org/dc/dcmitype/',\n  'xmlns:xsi': 'http://www.w3.org/2001/XMLSchema-instance',\n};\n\nutils.inherits(CoreXform, BaseXform, {\n  render(xmlStream, model) {\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n\n    xmlStream.openNode('cp:coreProperties', CoreXform.CORE_PROPERTY_ATTRIBUTES);\n\n    this.map['dc:creator'].render(xmlStream, model.creator);\n    this.map['dc:title'].render(xmlStream, model.title);\n    this.map['dc:subject'].render(xmlStream, model.subject);\n    this.map['dc:description'].render(xmlStream, model.description);\n    this.map['dc:identifier'].render(xmlStream, model.identifier);\n    this.map['dc:language'].render(xmlStream, model.language);\n    this.map['cp:keywords'].render(xmlStream, model.keywords);\n    this.map['cp:category'].render(xmlStream, model.category);\n    this.map['cp:lastModifiedBy'].render(xmlStream, model.lastModifiedBy);\n    this.map['cp:lastPrinted'].render(xmlStream, model.lastPrinted);\n    this.map['cp:revision'].render(xmlStream, model.revision);\n    this.map['cp:version'].render(xmlStream, model.version);\n    this.map['cp:contentStatus'].render(xmlStream, model.contentStatus);\n    this.map['cp:contentType'].render(xmlStream, model.contentType);\n    this.map['dcterms:created'].render(xmlStream, model.created);\n    this.map['dcterms:modified'].render(xmlStream, model.modified);\n\n    xmlStream.closeNode();\n  },\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    switch (node.name) {\n      case 'cp:coreProperties':\n      case 'coreProperties':\n        return true;\n      default:\n        this.parser = this.map[node.name];\n        if (this.parser) {\n          this.parser.parseOpen(node);\n          return true;\n        }\n        throw new Error(`Unexpected xml node in parseOpen: ${JSON.stringify(node)}`);\n    }\n  },\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  },\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.parser = undefined;\n      }\n      return true;\n    }\n    switch (name) {\n      case 'cp:coreProperties':\n      case 'coreProperties':\n        this.model = {\n          creator: this.map['dc:creator'].model,\n          title: this.map['dc:title'].model,\n          subject: this.map['dc:subject'].model,\n          description: this.map['dc:description'].model,\n          identifier: this.map['dc:identifier'].model,\n          language: this.map['dc:language'].model,\n          keywords: this.map['cp:keywords'].model,\n          category: this.map['cp:category'].model,\n          lastModifiedBy: this.map['cp:lastModifiedBy'].model,\n          lastPrinted: this.map['cp:lastPrinted'].model,\n          revision: this.map['cp:revision'].model,\n          contentStatus: this.map['cp:contentStatus'].model,\n          contentType: this.map['cp:contentType'].model,\n          created: this.map['dcterms:created'].model,\n          modified: this.map['dcterms:modified'].model,\n        };\n        return false;\n      default:\n        throw new Error(`Unexpected xml node in parseClose: ${name}`);\n    }\n  },\n});\n\nmodule.exports = CoreXform;\n"],"file":"core-xform.js"}