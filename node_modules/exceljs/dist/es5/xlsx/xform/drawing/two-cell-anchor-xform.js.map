{"version":3,"sources":["../../../../../lib/xlsx/xform/drawing/two-cell-anchor-xform.js"],"names":["utils","require","colCache","BaseXform","StaticXform","Anchor","CellPositionXform","PicXform","TwoCellAnchorXform","module","exports","map","tag","inherits","prepare","model","options","picture","range","decode","tl","buildModel","nativeCol","left","nativeRow","top","br","right","bottom","asInstance","render","xmlStream","editAs","openNode","closeNode","parseOpen","node","parser","name","reset","attributes","parseText","text","parseClose","undefined","reconcile","rId","rel","rels","match","Target","mediaId","mediaIndex","medium","media","Number","isInteger","row","col","encode"],"mappings":"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","file":"two-cell-anchor-xform.js","sourcesContent":["'use strict';\n\nvar utils = require('../../../utils/utils');\nvar colCache = require('../../../utils/col-cache');\nvar BaseXform = require('../base-xform');\nvar StaticXform = require('../static-xform');\nvar Anchor = require('../../../doc/anchor');\n\nvar CellPositionXform = require('./cell-position-xform');\nvar PicXform = require('./pic-xform');\n\nvar TwoCellAnchorXform = module.exports = function() {\n  this.map = {\n    'xdr:from': new CellPositionXform({tag: 'xdr:from'}),\n    'xdr:to': new CellPositionXform({tag: 'xdr:to'}),\n    'xdr:pic': new PicXform(),\n    'xdr:clientData': new StaticXform({tag: 'xdr:clientData'}),\n  };\n};\n\nutils.inherits(TwoCellAnchorXform, BaseXform, {\n  get tag() { return 'xdr:twoCellAnchor'; },\n\n  prepare: function(model, options) {\n    this.map['xdr:pic'].prepare(model.picture, options);\n\n    // convert model.range into tl, br\n    if (typeof model.range === 'string') {\n      var range = colCache.decode(model.range);\n      // Note - zero based\n      model.tl = CellPositionXform.buildModel({\n        nativeCol: range.left - 1,\n        nativeRow: range.top - 1\n      });\n      // zero based but also +1 to cover to bottom right of br cell\n      model.br = CellPositionXform.buildModel({\n        nativeCol: range.right,\n        nativeRow: range.bottom\n      });\n    } else {\n      model.range.tl = Anchor.asInstance(model.range.tl);\n      model.range.br = Anchor.asInstance(model.range.br);\n      model.tl = model.range.tl;\n      model.br = model.range.br;\n    }\n  },\n\n  render: function(xmlStream, model) {\n    if (model.range.editAs) {\n      xmlStream.openNode(this.tag, {editAs: model.range.editAs});\n    } else {\n      xmlStream.openNode(this.tag);\n    }\n\n    this.map['xdr:from'].render(xmlStream, model.tl);\n    this.map['xdr:to'].render(xmlStream, model.br);\n    this.map['xdr:pic'].render(xmlStream, model.picture);\n    this.map['xdr:clientData'].render(xmlStream, {});\n\n    xmlStream.closeNode();\n  },\n\n  parseOpen: function(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    switch (node.name) {\n      case this.tag:\n        this.reset();\n        this.model = {\n          editAs: node.attributes.editAs\n        };\n        break;\n      default:\n        this.parser = this.map[node.name];\n        if (this.parser) {\n          this.parser.parseOpen(node);\n        }\n        break;\n    }\n    return true;\n  },\n\n  parseText: function(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  },\n\n  parseClose: function(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.parser = undefined;\n      }\n      return true;\n    }\n    switch (name) {\n      case this.tag:\n        this.model = this.model || {};\n        this.model.tl = this.map['xdr:from'].model;\n        this.model.br = this.map['xdr:to'].model;\n        this.model.picture = this.map['xdr:pic'].model;\n        return false;\n      default:\n        // could be some unrecognised tags\n        return true;\n    }\n  },\n\n  reconcile: function(model, options) {\n    if (model.picture && model.picture.rId) {\n      var rel = options.rels[model.picture.rId];\n      var match = rel.Target.match(/.*\\/media\\/(.+[.][a-z]{3,4})/);\n      if (match) {\n        var name = match[1];\n        var mediaId = options.mediaIndex[name];\n        model.medium = options.media[mediaId];\n      }\n    }\n\n    model.tl = Anchor.asInstance(model.tl);\n    model.br = Anchor.asInstance(model.br);\n\n    if (model.tl && model.br && Number.isInteger(model.tl.row) && Number.isInteger(model.tl.col) && Number.isInteger(model.br.row) && Number.isInteger(model.br.col)) {\n      model.range = colCache.encode(model.tl.row + 1, model.tl.col + 1, model.br.row, model.br.col);\n    } else {\n      model.range = {\n        tl: model.tl,\n        br: model.br,\n      };\n    }\n    if (model.editAs) {\n      model.range.editAs = model.editAs;\n      delete model.editAs;\n    }\n    delete model.tl;\n    delete model.br;\n  }\n});\n"]}