{"version":3,"sources":["../../../../../lib/xlsx/xform/style/alignment-xform.js"],"names":["Enums","require","utils","BaseXform","validation","horizontalValues","reduce","p","v","horizontal","value","undefined","verticalValues","vertical","wrapText","shrinkToFit","textRotation","validInt","indent","Math","max","readingOrder","ReadingOrder","LeftToRight","RightToLeft","textRotationXform","toXml","tr","round","toModel","AlignmentXform","module","exports","inherits","tag","render","xmlStream","model","addRollback","openNode","isValid","add","name","addAttribute","closeNode","commit","rollback","parseOpen","node","valid","truthy","attributes","parseInt","parseText","parseClose"],"mappings":"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","sourcesContent":["'use strict';\n\nconst Enums = require('../../../doc/enums');\n\nconst utils = require('../../../utils/utils');\nconst BaseXform = require('../base-xform');\n\nconst validation = {\n  horizontalValues: ['left', 'center', 'right', 'fill', 'centerContinuous', 'distributed', 'justify'].reduce((p, v) => {\n    p[v] = true;\n    return p;\n  }, {}),\n  horizontal(value) {\n    return this.horizontalValues[value] ? value : undefined;\n  },\n\n  verticalValues: ['top', 'middle', 'bottom', 'distributed', 'justify'].reduce((p, v) => {\n    p[v] = true;\n    return p;\n  }, {}),\n  vertical(value) {\n    if (value === 'middle') return 'center';\n    return this.verticalValues[value] ? value : undefined;\n  },\n  wrapText(value) {\n    return value ? true : undefined;\n  },\n  shrinkToFit(value) {\n    return value ? true : undefined;\n  },\n  textRotation(value) {\n    switch (value) {\n      case 'vertical':\n        return value;\n      default:\n        value = utils.validInt(value);\n        return value >= -90 && value <= 90 ? value : undefined;\n    }\n  },\n  indent(value) {\n    value = utils.validInt(value);\n    return Math.max(0, value);\n  },\n  readingOrder(value) {\n    switch (value) {\n      case 'ltr':\n        return Enums.ReadingOrder.LeftToRight;\n      case 'rtl':\n        return Enums.ReadingOrder.RightToLeft;\n      default:\n        return undefined;\n    }\n  },\n};\n\nconst textRotationXform = {\n  toXml(textRotation) {\n    textRotation = validation.textRotation(textRotation);\n    if (textRotation) {\n      if (textRotation === 'vertical') {\n        return 255;\n      }\n\n      const tr = Math.round(textRotation);\n      if (tr >= 0 && tr <= 90) {\n        return tr;\n      }\n\n      if (tr < 0 && tr >= -90) {\n        return 90 - tr;\n      }\n    }\n    return undefined;\n  },\n  toModel(textRotation) {\n    const tr = utils.validInt(textRotation);\n    if (tr !== undefined) {\n      if (tr === 255) {\n        return 'vertical';\n      }\n      if (tr >= 0 && tr <= 90) {\n        return tr;\n      }\n      if (tr > 90 && tr <= 180) {\n        return 90 - tr;\n      }\n    }\n    return undefined;\n  },\n};\n\n// Alignment encapsulates translation from style.alignment model to/from xlsx\nconst AlignmentXform = (module.exports = function() {});\n\nutils.inherits(AlignmentXform, BaseXform, {\n  get tag() {\n    return 'alignment';\n  },\n\n  render(xmlStream, model) {\n    xmlStream.addRollback();\n    xmlStream.openNode('alignment');\n\n    let isValid = false;\n    function add(name, value) {\n      if (value) {\n        xmlStream.addAttribute(name, value);\n        isValid = true;\n      }\n    }\n    add('horizontal', validation.horizontal(model.horizontal));\n    add('vertical', validation.vertical(model.vertical));\n    add('wrapText', validation.wrapText(model.wrapText) ? '1' : false);\n    add('shrinkToFit', validation.shrinkToFit(model.shrinkToFit) ? '1' : false);\n    add('indent', validation.indent(model.indent));\n    add('textRotation', textRotationXform.toXml(model.textRotation));\n    add('readingOrder', validation.readingOrder(model.readingOrder));\n\n    xmlStream.closeNode();\n\n    if (isValid) {\n      xmlStream.commit();\n    } else {\n      xmlStream.rollback();\n    }\n  },\n\n  parseOpen(node) {\n    const model = {};\n\n    let valid = false;\n    function add(truthy, name, value) {\n      if (truthy) {\n        model[name] = value;\n        valid = true;\n      }\n    }\n    add(node.attributes.horizontal, 'horizontal', node.attributes.horizontal);\n    add(node.attributes.vertical, 'vertical', node.attributes.vertical === 'center' ? 'middle' : node.attributes.vertical);\n    add(node.attributes.wrapText, 'wrapText', !!node.attributes.wrapText);\n    add(node.attributes.shrinkToFit, 'shrinkToFit', !!node.attributes.shrinkToFit);\n    add(node.attributes.indent, 'indent', parseInt(node.attributes.indent, 10));\n    add(node.attributes.textRotation, 'textRotation', textRotationXform.toModel(node.attributes.textRotation));\n    add(node.attributes.readingOrder, 'readingOrder', node.attributes.readingOrder === '2' ? 'rtl' : 'ltr');\n\n    this.model = valid ? model : null;\n  },\n\n  parseText() {},\n  parseClose() {\n    return false;\n  },\n});\n"],"file":"alignment-xform.js"}