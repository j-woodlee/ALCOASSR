{"version":3,"sources":["../../../lib/doc/worksheet.js"],"names":["_","require","colCache","Range","Row","Column","Enums","Image","DataValidations","Worksheet","options","id","orderNo","name","state","_rows","_columns","_keys","_merges","rowBreaks","_workbook","workbook","properties","Object","assign","defaultRowHeight","dyDescent","outlineLevelCol","outlineLevelRow","pageSetup","margins","left","right","top","bottom","header","footer","orientation","horizontalDpi","verticalDpi","fitToPage","fitToWidth","fitToHeight","scale","pageOrder","blackAndWhite","draft","cellComments","errors","paperSize","undefined","showRowColHeaders","showGridLines","firstPageNumber","horizontalCentered","verticalCentered","colBreaks","dataValidations","views","autoFilter","_media","removeWorksheetEx","key","value","f","each","c","col","l2n","length","n","push","start","count","inserts","Array","prototype","slice","call","arguments","rows","nRows","i","rowArguments","forEach","insert","row","getRow","splice","apply","r","nExpand","nKeep","nEnd","getColumn","defn","definedNames","spliceColumns","_nextRow","values","addRow","rSrc","rDst","style","eachCell","includeEmpty","cell","colNumber","getCell","spliceRows","iteratee","hasValues","number","address","getAddress","findCell","getCellEx","dimensions","merge","intersects","Error","master","j","unmerge","type","ValueType","Merge","_unMergeMaster","range","formula","results","decoded","decode","width","masterAddress","encodeAddress","getResult","isArray","first","result","sharedFormula","imageId","model","filter","m","image","find","rowModel","mergeCells","rowDims","expand","min","max","_headerRowCount","reduce","pv","cv","headerCount","headers","Math","columns","column","maxCount","eachRow","cellCount","counts","_lastRowNumber","some","Boolean","console","trace","tabColor","media","map","medium","cols","toModel","merges","fromModel","_parseRows","_parseMergeCells","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nconst _ = require('../utils/under-dash');\n\nconst colCache = require('./../utils/col-cache');\nconst Range = require('./range');\nconst Row = require('./row');\nconst Column = require('./column');\nconst Enums = require('./enums');\nconst Image = require('./image');\nconst DataValidations = require('./data-validations');\n\n// Worksheet requirements\n//  Operate as sheet inside workbook or standalone\n//  Load and Save from file and stream\n//  Access/Add/Delete individual cells\n//  Manage column widths and row heights\n\nclass Worksheet {\n  constructor(options) {\n    options = options || {};\n\n    // in a workbook, each sheet will have a number\n    this.id = options.id;\n    this.orderNo = options.orderNo;\n\n    // and a name\n    this.name = options.name || `Sheet${this.id}`;\n\n    // add a state\n    this.state = options.state || 'visible';\n\n    // rows allows access organised by row. Sparse array of arrays indexed by row-1, col\n    // Note: _rows is zero based. Must subtract 1 to go from cell.row to index\n    this._rows = [];\n\n    // column definitions\n    this._columns = null;\n\n    // column keys (addRow convenience): key ==> this._collumns index\n    this._keys = {};\n\n    // keep record of all merges\n    this._merges = {};\n\n    // record of all row and column pageBreaks\n    this.rowBreaks = [];\n\n    this._workbook = options.workbook;\n\n    // for tabColor, default row height, outline levels, etc\n    this.properties = Object.assign(\n      {},\n      {\n        defaultRowHeight: 15,\n        dyDescent: 55,\n        outlineLevelCol: 0,\n        outlineLevelRow: 0,\n      },\n      options.properties\n    );\n\n    // for all things printing\n    this.pageSetup = Object.assign(\n      {},\n      {\n        margins: { left: 0.7, right: 0.7, top: 0.75, bottom: 0.75, header: 0.3, footer: 0.3 },\n        orientation: 'portrait',\n        horizontalDpi: 4294967295,\n        verticalDpi: 4294967295,\n        fitToPage: !!(options.pageSetup && ((options.pageSetup.fitToWidth || options.pageSetup.fitToHeight) && !options.pageSetup.scale)),\n        pageOrder: 'downThenOver',\n        blackAndWhite: false,\n        draft: false,\n        cellComments: 'None',\n        errors: 'displayed',\n        scale: 100,\n        fitToWidth: 1,\n        fitToHeight: 1,\n        paperSize: undefined,\n        showRowColHeaders: false,\n        showGridLines: false,\n        firstPageNumber: undefined,\n        horizontalCentered: false,\n        verticalCentered: false,\n        rowBreaks: null,\n        colBreaks: null,\n      },\n      options.pageSetup\n    );\n\n    this.dataValidations = new DataValidations();\n\n    // for freezepanes, split, zoom, gridlines, etc\n    this.views = options.views || [];\n\n    this.autoFilter = options.autoFilter || null;\n\n    // for images, etc\n    this._media = [];\n  }\n\n  get workbook() {\n    return this._workbook;\n  }\n\n  // when you're done with this worksheet, call this to remove from workbook\n  destroy() {\n    this._workbook.removeWorksheetEx(this);\n  }\n\n  // Get the bounding range of the cells in this worksheet\n  get dimensions() {\n    const dimensions = new Range();\n    this._rows.forEach(row => {\n      if (row) {\n        const rowDims = row.dimensions;\n        if (rowDims) {\n          dimensions.expand(row.number, rowDims.min, row.number, rowDims.max);\n        }\n      }\n    });\n    return dimensions;\n  }\n\n  // =========================================================================\n  // Columns\n\n  // get the current columns array.\n  get columns() {\n    return this._columns;\n  }\n\n  // set the columns from an array of column definitions.\n  // Note: any headers defined will overwrite existing values.\n  set columns(value) {\n    // calculate max header row count\n    this._headerRowCount = value.reduce((pv, cv) => {\n      const headerCount = (cv.header && 1) || (cv.headers && cv.headers.length) || 0;\n      return Math.max(pv, headerCount);\n    }, 0);\n\n    // construct Column objects\n    let count = 1;\n    const columns = (this._columns = []);\n    value.forEach(defn => {\n      const column = new Column(this, count++, false);\n      columns.push(column);\n      column.defn = defn;\n    });\n  }\n\n  getColumnKey(key) {\n    return this._keys[key];\n  }\n\n  setColumnKey(key, value) {\n    this._keys[key] = value;\n  }\n\n  deleteColumnKey(key) {\n    delete this._keys[key];\n  }\n\n  eachColumnKey(f) {\n    _.each(this._keys, f);\n  }\n\n  // get a single column by col number. If it doesn't exist, create it and any gaps before it\n  getColumn(c) {\n    if (typeof c === 'string') {\n      // if it matches a key'd column, return that\n      const col = this._keys[c];\n      if (col) return col;\n\n      // otherwise, assume letter\n      c = colCache.l2n(c);\n    }\n    if (!this._columns) {\n      this._columns = [];\n    }\n    if (c > this._columns.length) {\n      let n = this._columns.length + 1;\n      while (n <= c) {\n        this._columns.push(new Column(this, n++));\n      }\n    }\n    return this._columns[c - 1];\n  }\n\n  spliceColumns(start, count) {\n    // each member of inserts is a column of data.\n    const inserts = Array.prototype.slice.call(arguments, 2);\n    const rows = this._rows;\n    const nRows = rows.length;\n    if (inserts.length > 0) {\n      // must iterate over all rows whether they exist yet or not\n      for (let i = 0; i < nRows; i++) {\n        const rowArguments = [start, count];\n        // eslint-disable-next-line no-loop-func\n        inserts.forEach(insert => {\n          rowArguments.push(insert[i] || null);\n        });\n        const row = this.getRow(i + 1);\n        // eslint-disable-next-line prefer-spread\n        row.splice.apply(row, rowArguments);\n      }\n    } else {\n      // nothing to insert, so just splice all rows\n      this._rows.forEach(r => {\n        if (r) {\n          r.splice(start, count);\n        }\n      });\n    }\n\n    // splice column definitions\n    const nExpand = inserts.length - count;\n    const nKeep = start + count;\n    const nEnd = this._columns.length;\n    if (nExpand < 0) {\n      for (let i = start + inserts.length; i <= nEnd; i++) {\n        this.getColumn(i).defn = this.getColumn(i - nExpand).defn;\n      }\n    } else if (nExpand > 0) {\n      for (let i = nEnd; i >= nKeep; i--) {\n        this.getColumn(i + nExpand).defn = this.getColumn(i).defn;\n      }\n    }\n    for (let i = start; i < start + inserts.length; i++) {\n      this.getColumn(i).defn = null;\n    }\n\n    // account for defined names\n    this.workbook.definedNames.spliceColumns(this.name, start, count, inserts.length);\n  }\n\n  get columnCount() {\n    let maxCount = 0;\n    this.eachRow(row => {\n      maxCount = Math.max(maxCount, row.cellCount);\n    });\n    return maxCount;\n  }\n\n  get actualColumnCount() {\n    // performance nightmare - for each row, counts all the columns used\n    const counts = [];\n    let count = 0;\n    this.eachRow(row => {\n      row.eachCell(({ col }) => {\n        if (!counts[col]) {\n          counts[col] = true;\n          count++;\n        }\n      });\n    });\n    return count;\n  }\n\n  // =========================================================================\n  // Rows\n\n  _commitRow() {\n    // nop - allows streaming reader to fill a document\n  }\n\n  get _lastRowNumber() {\n    // need to cope with results of splice\n    const rows = this._rows;\n    let n = rows.length;\n    while (n > 0 && rows[n - 1] === undefined) {\n      n--;\n    }\n    return n;\n  }\n\n  get _nextRow() {\n    return this._lastRowNumber + 1;\n  }\n\n  get lastRow() {\n    if (this._rows.length) {\n      return this._rows[this._rows.length - 1];\n    }\n    return undefined;\n  }\n\n  // find a row (if exists) by row number\n  findRow(r) {\n    return this._rows[r - 1];\n  }\n\n  get rowCount() {\n    return this._lastRowNumber;\n  }\n\n  get actualRowCount() {\n    // counts actual rows that have actual data\n    let count = 0;\n    this.eachRow(() => {\n      count++;\n    });\n    return count;\n  }\n\n  // get a row by row number.\n  getRow(r) {\n    let row = this._rows[r - 1];\n    if (!row) {\n      row = this._rows[r - 1] = new Row(this, r);\n    }\n    return row;\n  }\n\n  addRow(value) {\n    const row = this.getRow(this._nextRow);\n    row.values = value;\n    return row;\n  }\n\n  addRows(value) {\n    value.forEach(row => {\n      this.addRow(row);\n    });\n  }\n\n  spliceRows(start, count) {\n    // same problem as row.splice, except worse.\n    const inserts = Array.prototype.slice.call(arguments, 2);\n    const nKeep = start + count;\n    const nExpand = inserts.length - count;\n    const nEnd = this._rows.length;\n    let i;\n    let rSrc;\n    if (nExpand < 0) {\n      // remove rows\n      for (i = nKeep; i <= nEnd; i++) {\n        rSrc = this._rows[i - 1];\n        if (rSrc) {\n          const rDst = this.getRow(i + nExpand);\n          rDst.values = rSrc.values;\n          rDst.style = rSrc.style;\n          // eslint-disable-next-line no-loop-func\n          rSrc.eachCell({ includeEmpty: true }, (cell, colNumber) => {\n            rDst.getCell(colNumber).style = cell.style;\n          });\n          this._rows[i - 1] = undefined;\n        } else {\n          this._rows[i + nExpand - 1] = undefined;\n        }\n      }\n    } else if (nExpand > 0) {\n      // insert new cells\n      for (i = nEnd; i >= nKeep; i--) {\n        rSrc = this._rows[i - 1];\n        if (rSrc) {\n          const rDst = this.getRow(i + nExpand);\n          rDst.values = rSrc.values;\n          rDst.style = rSrc.style;\n          // eslint-disable-next-line no-loop-func\n          rSrc.eachCell({ includeEmpty: true }, (cell, colNumber) => {\n            rDst.getCell(colNumber).style = cell.style;\n          });\n        } else {\n          this._rows[i + nExpand - 1] = undefined;\n        }\n      }\n    }\n\n    // now copy over the new values\n    for (i = 0; i < inserts.length; i++) {\n      const rDst = this.getRow(start + i);\n      rDst.style = {};\n      rDst.values = inserts[i];\n    }\n\n    // account for defined names\n    this.workbook.definedNames.spliceRows(this.name, start, count, inserts.length);\n  }\n\n  // iterate over every row in the worksheet, including maybe empty rows\n  eachRow(options, iteratee) {\n    if (!iteratee) {\n      iteratee = options;\n      options = undefined;\n    }\n    if (options && options.includeEmpty) {\n      const n = this._rows.length;\n      for (let i = 1; i <= n; i++) {\n        iteratee(this.getRow(i), i);\n      }\n    } else {\n      this._rows.forEach(row => {\n        if (row && row.hasValues) {\n          iteratee(row, row.number);\n        }\n      });\n    }\n  }\n\n  // return all rows as sparse array\n  getSheetValues() {\n    const rows = [];\n    this._rows.forEach(row => {\n      if (row) {\n        rows[row.number] = row.values;\n      }\n    });\n    return rows;\n  }\n\n  // =========================================================================\n  // Cells\n\n  // returns the cell at [r,c] or address given by r. If not found, return undefined\n  findCell(r, c) {\n    const address = colCache.getAddress(r, c);\n    const row = this._rows[address.row - 1];\n    return row ? row.findCell(address.col) : undefined;\n  }\n\n  // return the cell at [r,c] or address given by r. If not found, create a new one.\n  getCell(r, c) {\n    const address = colCache.getAddress(r, c);\n    const row = this.getRow(address.row);\n    return row.getCellEx(address);\n  }\n\n  // =========================================================================\n  // Merge\n\n  // convert the range defined by ['tl:br'], [tl,br] or [t,l,b,r] into a single 'merged' cell\n  mergeCells() {\n    const dimensions = new Range(Array.prototype.slice.call(arguments, 0)); // convert arguments into Array\n\n    // check cells aren't already merged\n    _.each(this._merges, merge => {\n      if (merge.intersects(dimensions)) {\n        throw new Error('Cannot merge already merged cells');\n      }\n    });\n\n    // apply merge\n    const master = this.getCell(dimensions.top, dimensions.left);\n    for (let i = dimensions.top; i <= dimensions.bottom; i++) {\n      for (let j = dimensions.left; j <= dimensions.right; j++) {\n        // merge all but the master cell\n        if (i > dimensions.top || j > dimensions.left) {\n          this.getCell(i, j).merge(master);\n        }\n      }\n    }\n\n    // index merge\n    this._merges[master.address] = dimensions;\n  }\n\n  _unMergeMaster(master) {\n    // master is always top left of a rectangle\n    const merge = this._merges[master.address];\n    if (merge) {\n      for (let i = merge.top; i <= merge.bottom; i++) {\n        for (let j = merge.left; j <= merge.right; j++) {\n          this.getCell(i, j).unmerge();\n        }\n      }\n      delete this._merges[master.address];\n    }\n  }\n\n  get hasMerges() {\n    // return true if this._merges has a merge object\n    return _.some(this._merges, Boolean);\n  }\n\n  // scan the range defined by ['tl:br'], [tl,br] or [t,l,b,r] and if any cell is part of a merge,\n  // un-merge the group. Note this function can affect multiple merges and merge-blocks are\n  // atomic - either they're all merged or all un-merged.\n  unMergeCells() {\n    const dimensions = new Range(Array.prototype.slice.call(arguments, 0)); // convert arguments into Array\n\n    // find any cells in that range and unmerge them\n    for (let i = dimensions.top; i <= dimensions.bottom; i++) {\n      for (let j = dimensions.left; j <= dimensions.right; j++) {\n        const cell = this.findCell(i, j);\n        if (cell) {\n          if (cell.type === Enums.ValueType.Merge) {\n            // this cell merges to another master\n            this._unMergeMaster(cell.master);\n          } else if (this._merges[cell.address]) {\n            // this cell is a master\n            this._unMergeMaster(cell);\n          }\n        }\n      }\n    }\n  }\n\n  // ===========================================================================\n  // Shared Formula\n  fillFormula(range, formula, results) {\n    // Define formula for top-left cell and share to rest\n    const decoded = colCache.decode(range);\n    const { top, left, bottom, right } = decoded;\n    const width = right - left + 1;\n    const masterAddress = colCache.encodeAddress(top, left);\n\n    // work out result accessor\n    let getResult;\n    if (typeof results === 'function') {\n      getResult = results;\n    } else if (Array.isArray(results)) {\n      if (Array.isArray(results[0])) {\n        getResult = (row, col) => results[row - top][col - left];\n      } else {\n        getResult = (row, col) => results[((row - top) * width) + (col - left)];\n      }\n    } else {\n      getResult = () => undefined;\n    }\n    let first = true;\n    for (let r = top; r <= bottom; r++) {\n      for (let c = left; c <= right; c++) {\n        if (first) {\n          this.getCell(r, c).value = {\n            formula,\n            result: getResult(r, c),\n          };\n          first = false;\n        } else {\n          this.getCell(r, c).value = {\n            sharedFormula: masterAddress,\n            result: getResult(r, c),\n          };\n        }\n      }\n    }\n  }\n\n  // =========================================================================\n  // Images\n  addImage(imageId, range) {\n    const model = {\n      type: 'image',\n      imageId,\n      range,\n    };\n    this._media.push(new Image(this, model));\n  }\n\n  getImages() {\n    return this._media.filter(m => m.type === 'image');\n  }\n\n  addBackgroundImage(imageId) {\n    const model = {\n      type: 'background',\n      imageId,\n    };\n    this._media.push(new Image(this, model));\n  }\n\n  getBackgroundImageId() {\n    const image = this._media.find(m => m.type === 'background');\n    return image && image.imageId;\n  }\n\n  // ===========================================================================\n  // Deprecated\n  get tabColor() {\n    // eslint-disable-next-line no-console\n    console.trace('worksheet.tabColor property is now deprecated. Please use worksheet.properties.tabColor');\n    return this.properties.tabColor;\n  }\n\n  set tabColor(value) {\n    // eslint-disable-next-line no-console\n    console.trace('worksheet.tabColor property is now deprecated. Please use worksheet.properties.tabColor');\n    this.properties.tabColor = value;\n  }\n\n  // ===========================================================================\n  // Model\n\n  get model() {\n    const model = {\n      id: this.id,\n      name: this.name,\n      dataValidations: this.dataValidations.model,\n      properties: this.properties,\n      state: this.state,\n      pageSetup: this.pageSetup,\n      rowBreaks: this.rowBreaks,\n      views: this.views,\n      autoFilter: this.autoFilter,\n      media: this._media.map(medium => medium.model),\n    };\n\n    // =================================================\n    // columns\n    model.cols = Column.toModel(this.columns);\n\n    // ==========================================================\n    // Rows\n    const rows = (model.rows = []);\n    const dimensions = (model.dimensions = new Range());\n    this._rows.forEach(row => {\n      const rowModel = row && row.model;\n      if (rowModel) {\n        dimensions.expand(rowModel.number, rowModel.min, rowModel.number, rowModel.max);\n        rows.push(rowModel);\n      }\n    });\n\n    // ==========================================================\n    // Merges\n    model.merges = [];\n    _.each(this._merges, merge => {\n      model.merges.push(merge.range);\n    });\n\n    return model;\n  }\n\n  _parseRows(model) {\n    this._rows = [];\n    model.rows.forEach(rowModel => {\n      const row = new Row(this, rowModel.number);\n      this._rows[row.number - 1] = row;\n      row.model = rowModel;\n    });\n  }\n\n  _parseMergeCells(model) {\n    _.each(model.mergeCells, merge => {\n      this.mergeCells(merge);\n    });\n  }\n\n  set model(value) {\n    this.name = value.name;\n    this._columns = Column.fromModel(this, value.cols);\n    this._parseRows(value);\n\n    this._parseMergeCells(value);\n    this.dataValidations = new DataValidations(value.dataValidations);\n    this.properties = value.properties;\n    this.pageSetup = value.pageSetup;\n    this.views = value.views;\n    this.autoFilter = value.autoFilter;\n    this._media = value.media.map(medium => new Image(this, medium));\n  }\n}\n\nmodule.exports = Worksheet;\n"],"file":"worksheet.js"}